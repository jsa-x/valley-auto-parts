{% extends "base.html" %}
{% block title %}Cart | Valley Auto Parts{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto">

  <div class="flex items-center justify-between mb-4">
    <h1 class="text-xl font-semibold text-slate-800">
      Your Cart
    </h1>
    {% if item_count and item_count > 0 %}
      <form method="POST" action="{{ url_for('cart_clear') }}">
        <button
          type="submit"
          class="text-xs text-red-600 hover:text-red-700 font-semibold"
        >
          Clear cart
        </button>
      </form>
    {% endif %}
  </div>

  {% if banner %}
  <div class="mb-3 rounded-md border border-green-300 bg-green-100 text-green-700 text-sm font-medium px-4 py-2 text-center shadow">
    {{ banner }}
  </div>
  {% endif %}

  {% if not items %}
    <p class="text-sm text-slate-600">
      Your cart is currently empty. Browse the shop and add parts to see them here.
    </p>
  {% else %}
    <div class="bg-white border border-slate-200 rounded-xl shadow-sm p-4 text-sm text-slate-700">
      <div class="overflow-x-auto">
        <table class="w-full text-left text-sm">
          <thead>
            <tr class="border-b border-slate-300 text-xs uppercase text-slate-500">
              <th class="py-2 pr-4">Item</th>
              <th class="py-2 text-center">Qty</th>
              <th class="py-2 text-right">Price</th>
              <th class="py-2 text-right">Subtotal</th>
            </tr>
          </thead>
          <tbody>
            {% for item in items %}
            <tr class="border-b border-slate-200">
              <td class="py-2 pr-4">
                <div class="font-medium text-slate-800 text-sm">{{ item.name }}</div>
                <div class="text-xs text-slate-500">{{ item.fitment }}</div>
              </td>
              <td class="py-2 text-center text-sm">{{ item.qty }}</td>
              <td class="py-2 text-right text-sm">${{ '%.2f'|format(item.unit_price) }}</td>
              <td class="py-2 text-right text-sm flex items-center justify-end gap-3">
                <span>${{ '%.2f'|format(item.line_total) }}</span>
                <form method="POST" action="{{ url_for('cart_remove') }}">
                  <input type="hidden" name="pid" value="{{ item.id }}">
                  <button
                    type="submit"
                    class="text-xs text-red-600 hover:text-red-700"
                  >
                    Remove
                  </button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="flex justify-between items-center mt-4">
        <div class="text-sm text-slate-500">
          Items in cart: {{ item_count }}
        </div>
        <div class="text-right">
          <div class="text-xs text-slate-500">Total</div>
          <div class="text-lg font-semibold text-slate-900">
            ${{ '%.2f'|format(total) }}
          </div>
        </div>
      </div>

      <div class="mt-4 flex justify-end">
        <form method="GET" action="{{ url_for('payment') }}">
          <button
            class="bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-md px-4 py-2 transition"
            type="submit"
          >
            Proceed to Payment
          </button>
        </form>
      </div>
    </div>
  {% endif %}

</div>
{% endblock %}

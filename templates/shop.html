{% extends "base.html" %}
{% block title %}Shop | Valley Auto Parts{% endblock %}

{% block content %}

<div class="w-full">

  {# Status banner after login, etc. #}
  {% if banner %}
  <div
    class="mb-4 rounded-md border border-green-300 bg-green-100 text-green-700 text-sm font-medium px-4 py-2 text-center shadow"
  >
    {{ banner }}
  </div>
  {% endif %}

  <!-- welcome text -->
  <header class="page-header mb-4">
    <h1 class="text-xl font-semibold text-slate-800">
      Auto Parts Currently In Stock
    </h1>

    {% if logged_in %}
      <p class="text-slate-600 text-sm mt-1">
        Welcome back, {{ username }}. Add parts to your cart.
      </p>
    {% else %}
      <p class="text-slate-600 text-sm mt-1">
        Brakes, filters, and more — log in to start adding items.
      </p>
    {% endif %}
  </header>

  <form class="mb-4 flex flex-col gap-2 sm:flex-row sm:items-center sm:justify-between" method="get" action="{{ url_for('shop') }}">
    <div class="flex items-center gap-2">
      <label for="vehicle" class="text-xs text-slate-600 whitespace-nowrap">
        Vehicle:
      </label>
      <select
        id="vehicle"
        name="vehicle"
        class="rounded-md border border-slate-300 bg-white px-2 py-1.5 text-xs text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
        onchange="this.form.submit()"
      >
        <option value="" {% if not vehicle %}selected{% endif %}>All vehicles</option>
        {% for v in vehicle_options %}
          <option value="{{ v }}" {% if vehicle == v %}selected{% endif %}>{{ v }}</option>
        {% endfor %}
      </select>
    </div>

    <div class="flex flex-col sm:flex-row sm:items-center gap-2 w-full sm:w-auto">
      <input
        id="search"
        name="q"
        type="search"
        placeholder="Search parts…"
        value="{{ query }}"
        class="w-full sm:w-72 rounded-md border border-slate-300 bg-white px-3 py-2 text-sm text-slate-800 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
      >
      <button
        type="submit"
        class="inline-flex items-center justify-center bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded-md px-3 py-2 transition"
      >
        Search
      </button>
      <p class="text-xs text-slate-500 whitespace-nowrap">
        {{ parts|length }} parts found
      </p>
    </div>
  </form>

  {% if parts|length == 0 %}
    <div class="rounded-md border border-amber-200 bg-amber-50 text-amber-800 text-sm px-4 py-3">
      No parts match that search. Try a different keyword or vehicle.
    </div>
  {% else %}
    <div class="grid gap-6 grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4">
      {% for p in parts %}
      <div class="product-card bg-white border border-slate-200 rounded-xl shadow-sm flex flex-col overflow-hidden">
        <div class="product-img-wrap bg-slate-200">
          <img
            class="product-img w-full h-44 object-cover"
            src="{{ p.img }}"
            alt="{{ p.name }}"
          >
        </div>

        <div class="product-info flex flex-col p-4 flex-1">
          <div class="product-format mb-2">
            <span class="inline-block bg-slate-800 text-white text-[0.7rem] font-medium rounded px-2 py-1">
              {{ p.category or "Part" }}
            </span>
          </div>

          <div class="product-title text-slate-900 font-semibold text-sm leading-snug">
            <a href="{{ url_for('product_detail', pid=p.id) }}" class="hover:underline">
              {{ p.name }}
            </a>
          </div>

          <div class="product-fitment text-[0.8rem] text-slate-600 mt-1">
            {{ p.fitment or "" }}
          </div>

          <div class="product-desc text-[0.8rem] text-slate-500 mt-3 flex-1">
            {{ p.description or "" }}
          </div>

          <div class="product-bottom flex items-center justify-between border-t border-slate-200 mt-4 pt-3">
            <div class="product-price text-slate-900 font-semibold text-sm">
              ${{ '%.2f'|format(p.price) }}
            </div>
            {% if logged_in %}
            <form method="POST" action="{{ url_for('cart_add') }}">
              <input type="hidden" name="pid" value="{{ p.id }}">
              <button
                class="bg-blue-600 hover:bg-blue-700 text-white text-[0.75rem] font-semibold rounded-md px-3 py-1.5 transition"
                type="submit"
              >
                Add to Cart
              </button>
            </form>
            {% else %}
            <button
              class="bg-slate-400 text-white text-[0.75rem] font-semibold rounded-md px-3 py-1.5 cursor-not-allowed"
              disabled
            >
              Login to buy
            </button>
            {% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% endif %}

</div>

{% endblock %}
